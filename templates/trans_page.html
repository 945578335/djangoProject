

<!DOCTYPE html>
<html>

<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">

    <title>Bootstrap Admin Template </title>
    <link rel="shortcut icon" href="/static/index/img/favicon.ico">
    
    <!-- global stylesheets -->
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
    <link rel="stylesheet" href="/static/index/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/index/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/static/index/css/font-icon-style.css">
    <link rel="stylesheet" href="/static/index/css/style.default.css" id="theme-stylesheet">

    <!-- Core stylesheets -->
    <link rel="stylesheet" href="/static/index/css/form.css">
    <script src="/static/index/js/jquery.min.js"></script>
    <script src="/static/index/js/jquery.cookie.js"></script>
</head>

<script>

    console.log($.cookie('username_ip'));
    console.log($.cookie('ip'));

    var socket = new WebSocket("ws://{{ ip }}:8000/chatchannel/{{ roomnum }}/");

    socket.onopen = function (event){

        {#let tag = document.createElement("div");#}
        {#tag.innerHTML = "[连接成功]";#}
        {#document.getElementById("trans_message").appendChild(tag);#}

    }

    socket.onmessage = function (event){

        let div =  document.createElement("div");
        let name =  document.createElement("div");
        let final_node = document.createElement("div");
        let hashchain = document.createElement("label");

        let json_message = JSON.parse(event.data);

        name.innerText = "[" + json_message['username_ip'] + "]" + ": " + json_message['content'];
        final_node.innerText = "[Hash_Chain]" + ": " + json_message['final_node'];
        hashchain.setAttribute("class", "badge badge-success");
        hashchain.innerText = "哈希链验证成功";

        div.appendChild(name);
        div.appendChild(final_node);
        div.appendChild(hashchain);

        if(json_message['signature_txt'] != ""){

            let signature = document.createElement("label");
            signature.setAttribute("class", "badge badge-info");

            let signature_txt = document.createElement("div");
            signature_txt.innerText = "[Signature]" + ": " + json_message['signature_txt'];

            signature.innerText = "链式签名验证成功";
            div.appendChild(signature_txt);
            div.appendChild(signature);

        }

        let itv =  document.createElement("div");
        itv.innerText = "-----------------------------------------------------------------------------------------------------------------------------------";
        div.appendChild(itv);

        document.getElementById('trans_message').appendChild(div);

    }

    function sendMessage(){
        let dip = document.getElementById('dip');
        let tag = document.getElementById('message_content');
        if(tag.value != ""){
            let sig_opt = $("#signature_method_select option:selected");
            let con_opt = $("#construction_method_select option:selected");
            let json_message = {"sip":$.cookie('username_ip'), "dip":dip.value, 'content':tag.value, 'sig_opt':sig_opt.val(), 'con_opt': con_opt.val()}
            socket.send(JSON.stringify(json_message));
            tag.value = "";
        }
    }

    function randomString() {
        length = 64;
        var str = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
        var result = '';
        for (var i = length; i > 0; --i)
            result += str[Math.floor(Math.random() * str.length)];
        return result;
}

    function sendMessage_lot(){


        let dip = document.getElementById('dip');
        dip.setAttribute("disabled", "disabled");

        let sig_slt = document.getElementById('signature_method_select');
        sig_slt.setAttribute("disabled", "disabled");

        let con_slt = document.getElementById('construction_method_select');
        con_slt.setAttribute("disabled", "disabled");

        let sig_opt = $("#signature_method_select option:selected");
        let con_opt = $("#construction_method_select option:selected");
        var i = 0;
        while (i <1000){
            random_str = randomString();
            let json_message = {"sip":$.cookie('username_ip'), "dip":dip.value, 'content':random_str, 'sig_opt':sig_opt.val(), 'con_opt': con_opt.val()}
            socket.send(JSON.stringify(json_message));
            setTimeout(function (){console.log("111");}, 2000);
            i ++;
        }
        dip.removeAttribute("disabled");
        sig_slt.removeAttribute("disabled");
        con_slt.removeAttribute("disabled");

    }

    function closeMessage(){
        socket.close();
    }

    function recv_msg_page(){
        let sip = document.getElementById('sip').getAttribute("placeholder");
        let dip = document.getElementById('dip').value;
        let url = "http://" + "{{ ip }}" + ":8000/show_chain_page/?sip=" + sip +"&dip=" + dip;
        window.location.href = url;
    }

</script>

<body>
    
<!--====================================================
                     MAIN NAVBAR
======================================================-->
    <header class="header">
        <nav class="navbar navbar-expand-lg ">
            <div class="search-box">
                <button class="dismiss"><i class="icon-close"></i></button>
                <form id="searchForm" action="#" role="search">
                    <input type="search" placeholder="Search Now" class="form-control">
                </form>
            </div>
            <div class="container-fluid ">
                <div class="navbar-holder d-flex align-items-center justify-content-between">
                    <div class="navbar-header">
                        <a href="index.html" class="navbar-brand">
                            <div class="brand-text brand-big hidden-lg-down"><img src="/static/index/img/logo-white.png" alt="Logo" class="img-fluid"></div>
                            <div class="brand-text brand-small"><img src="/static/index/img/logo-icon.png" alt="Logo" class="img-fluid"></div>
                        </a>
                        <a id="toggle-btn" href="#" class="menu-btn active">
                            <span></span>
                            <span></span>
                            <span></span>
                        </a>
                    </div>
                </div>
                <ul class="nav-menu list-unstyled d-flex flex-md-row align-items-md-center">
                    <!-- Expand-->
                    <li class="nav-item d-flex align-items-center full_scr_exp"><a class="nav-link" href="#"><img src="/static/index/img/expand.png" onclick="toggleFullScreen(document.body)" class="img-fluid" alt=""></a></li>

                    <!-- Notifications-->
                    <li class="nav-item dropdown">
                        <a id="notifications" class="nav-link" rel="nofollow" data-target="#" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-bell-o"></i><span class="noti-numb-bg"></span><span class="badge">12</span></a>
                        <ul aria-labelledby="notifications" class="dropdown-menu">
                            <li>
                                <a rel="nofollow" href="#" class="dropdown-item nav-link">
                                    <div class="notification">
                                        <div class="notification-content"><i class="fa fa-envelope bg-red"></i>You have 6 new messages </div>
                                        <div class="notification-time"><small>4 minutes ago</small></div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a rel="nofollow" href="#" class="dropdown-item nav-link">
                                    <div class="notification">
                                        <div class="notification-content"><i class="fa fa-twitter bg-skyblue"></i>You have 2 followers</div>
                                        <div class="notification-time"><small>4 minutes ago</small></div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a rel="nofollow" href="#" class="dropdown-item nav-link">
                                    <div class="notification">
                                        <div class="notification-content"><i class="fa fa-upload bg-blue"></i>Server Rebooted</div>
                                        <div class="notification-time"><small>4 minutes ago</small></div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a rel="nofollow" href="#" class="dropdown-item nav-link">
                                    <div class="notification">
                                        <div class="notification-content"><i class="fa fa-twitter bg-skyblue"></i>You have 2 followers</div>
                                        <div class="notification-time"><small>10 minutes ago</small></div>
                                    </div>
                                </a>
                            </li>
                            <li><a rel="nofollow" href="#" class="dropdown-item all-notifications text-center"> <strong>view all notifications                                            </strong></a></li>
                        </ul>
                    </li>
                    <!-- Messages                        -->
                    <li class="nav-item dropdown"> <a id="messages" class="nav-link logout" rel="nofollow" data-target="#" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-envelope-o"></i><span class="noti-numb-bg"></span><span class="badge">10</span></a>
                        <ul aria-labelledby="messages" class="dropdown-menu">
                            <li>
                                <a rel="nofollow" href="#" class="dropdown-item d-flex">
                                    <div class="msg-profile"> <img src="/static/index/img/avatar-1.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                    <div class="msg-body">
                                        <h3 class="h5 msg-nav-h3">Jason Doe</h3><span>Sent You Message</span>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a rel="nofollow" href="#" class="dropdown-item d-flex">
                                    <div class="msg-profile"> <img src="/static/index/img/avatar-2.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                    <div class="msg-body">
                                        <h3 class="h5 msg-nav-h3">Frank Williams</h3><span>Sent You Message</span>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a rel="nofollow" href="#" class="dropdown-item d-flex">
                                    <div class="msg-profile"> <img src="/static/index/img/avatar-3.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                    <div class="msg-body">
                                        <h3 class="h5 msg-nav-h3">Ashley Wood</h3><span>Sent You Message</span>
                                    </div>
                                </a>
                            </li>
                            <li><a rel="nofollow" href="#" class="dropdown-item all-notifications text-center"> <strong>Read all messages    </strong></a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown"><a id="profile" class="nav-link logout" data-target="#" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="/static/index/img/avatar-1.jpg" alt="..." class="img-fluid rounded-circle" style="height: 30px; width: 30px;"></a>
                        <ul aria-labelledby="profile" class="dropdown-menu profile">
                            <li>
                                <a rel="nofollow" href="#" class="dropdown-item d-flex">
                                    <div class="msg-profile"> <img src="/static/index/img/avatar-1.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                    <div class="msg-body">
                                        <h3 class="h5"></h3>
                                    </div>
                                </a>
                                <hr>
                            </li>
                            <li>
                                <a rel="nofollow" href="profile.html" class="dropdown-item">
                                    <div class="notification">
                                        <div class="notification-content"><i class="fa fa-user "></i>My Profile</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a rel="nofollow" href="profile.html" class="dropdown-item">
                                    <div class="notification">
                                        <div class="notification-content"><i class="fa fa-envelope-o"></i>Inbox</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a rel="nofollow" href="profile.html" class="dropdown-item">
                                    <div class="notification">
                                        <div class="notification-content"><i class="fa fa-cog"></i>Setting</div>
                                    </div>
                                </a>
                                <hr>
                            </li>
                            <li>
                                <a rel="nofollow" href="http://{{ ip }}:8000" class="dropdown-item">
                                    <div class="notification">
                                        <div class="notification-content"><i class="fa fa-power-off"></i>Logout</div>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <nav id="sidebar-wrapper">
                      <div class="sidebar-nav">
                        <div class="tab" role="tabpanel">
                            <ul class="nav nav-tabs" role="tablist">
                              <li class="nav-item ">
                                <a class="nav-link active" href="#live" role="tab" data-toggle="tab"><i class="fa fa-globe"></i> Live</a>
                              </li>
                              <li class="nav-item">
                                <a class="nav-link" href="#trend" role="tab" data-toggle="tab"><i class="fa fa-rocket"></i> Trending</a>
                              </li>
                            </ul>
                            <div class="tab-content tabs">
                              <div role="tabpanel" class="tab-pane fade show active" id="live">
                                <h3>Connect Live</h3>
                                <div class="content newsf-list">
                                    <ul class="list-unstyled">
                                        <li class="border border-primary">
                                            <a rel="nofollow " href="#" class=" d-flex">
                                                <div class="news-f-img"> <img src="/static/index/img/avatar-2.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                                <div class="msg-body">
                                                    <h6 class="h5 msg-nav-h6">New Innovation world</h6>
                                                    <small>Tech soft is great innovation for...</small>
                                                </div>
                                            </a>
                                        </li>
                                        <li class="border border-success">
                                            <a rel="nofollow" href="#" class=" d-flex">
                                                <div class="news-f-img"> <img src="/static/index/img/avatar-3.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                                <div class="msg-body">
                                                    <h6 class="h5 msg-nav-h6">Modified hand-cart</h6>
                                                    <small>The idea is to incorporate easy...</small>
                                                </div>
                                            </a>
                                        </li>
                                        <li class="border border-info">
                                            <a rel="nofollow" href="#" class=" d-flex">
                                                <div class="news-f-img"> <img src="/static/index/img/avatar-4.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                                <div class="msg-body">
                                                    <h6 class="h5 msg-nav-h6">Low cost Modern printer</h6>
                                                    <small>A dot matrix printer modified at...</small>
                                                </div>
                                            </a>
                                        </li>
                                        <li class="border border-primary">
                                            <a rel="nofollow" href="#" class=" d-flex">
                                                <div class="news-f-img"> <img src="/static/index/img/avatar-1.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                                <div class="msg-body">
                                                    <h6 class="h5 msg-nav-h6">Low cost Modern printer</h6>
                                                    <small>A dot matrix printer modified at...</small>
                                                </div>
                                            </a>
                                        </li>
                                        <li class="border border-success">
                                            <a rel="nofollow" href="#" class=" d-flex">
                                                <div class="news-f-img"> <img src="/static/index/img/avatar-2.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                                <div class="msg-body">
                                                    <h6 class="h5 msg-nav-h6">Low cost Modern printer</h6>
                                                    <small>A dot matrix printer modified at...</small>
                                                </div>
                                            </a>
                                        </li>
                                        <li class="border border-info">
                                            <a rel="nofollow" href="#" class=" d-flex">
                                                <div class="news-f-img"> <img src="/static/index/img/avatar-3.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                                <div class="msg-body">
                                                    <h6 class="h5 msg-nav-h6">Low cost Modern printer</h6>
                                                    <small>A dot matrix printer modified at...</small>
                                                </div>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                              </div>
                              <div role="tabpanel" class="tab-pane fade" id="trend">
                                <div class="card card-c2" style="box-shadow: 0 0 0;">
                                    <div class="header">
                                        <h3 class="title">Trending Items</h3>
                                        <p class="category">Last Campaign Performance</p>
                                    </div>
                                    <div class="content">
                                        <canvas class="ct-chart" id="myChart-nav" height="250"></canvas>
                                        <div class="footer">
                                            <div class="legend">
                                                <i class="fa fa-circle text-info"></i> Open
                                                <i class="fa fa-circle text-danger"></i> Bounce
                                                <i class="fa fa-circle text-warning"></i> Unsubscribe
                                            </div>
                                            <hr>
                                            <div class="stats">
                                                <i class="fa fa-clock-o"></i> Campaign sent 2 days ago
                                            </div>
                                        </div>
                                    </div>
                                </div>
                              </div>
                           </div>
                        </div>
                      </div>
                    </nav>
                </ul>
            </div>
        </nav>
    </header>

<!--====================================================
                    PAGE CONTENT
======================================================-->
    <div class="page-content d-flex align-items-stretch">
       
        <!--***** SIDE NAVBAR *****-->
        <nav class="side-navbar">
            <div class="sidebar-header d-flex align-items-center">
                <div class="avatar"><img src="/static/index/img/avatar-1.jpg" alt="..." class="img-fluid rounded-circle"></div>
                <div class="title">
                    <h1 class="h4"></h1>
                </div>
            </div>
            <hr>
            <!-- Sidebar Navidation Menus-->
            <ul class="list-unstyled">

                <li> <a href="http://{{ ip }}:8000/phc/phcindex/"><i class="icon-home"></i>简介</a></li>
                <li class="active"> <a href="http://{{ ip }}:8000/trans_page/?hashchain={{ roomnum }}/"><i class="fa fa-globe"></i>传输</a></li>
                <li><a href="#construction_method" aria-expanded="false" data-toggle="collapse"> <i class="icon-interface-windows"></i>构建方法 </a>
                    <ul id="construction_method" class="collapse list-unstyled">
                        <li><a href="http://{{ ip }}:8000/phc/basic_hash_index/">基本构建方法</a></li>
                        <li><a href="http://{{ ip }}:8000/phc/share_hash_index/">共享密钥构建方法</a></li>
                        <li><a href="http://{{ ip }}:8000/phc/salt_hash_index/">哈希加盐构建方法</a></li>
                        <li><a href="http://{{ ip }}:8000/phc/mutual_hash_index/">双向哈希构建方法</a></li>
                    </ul>
                </li>
                <li><a href="#signature_method" aria-expanded="false" data-toggle="collapse"> <i class="fa fa-building-o"></i>签名方法 </a>
                    <ul id="signature_method" class="collapse list-unstyled">
                        <li><a href="http://{{ ip }}:8000/phc/first_sign_index/">首包签名</a></li>
                        <li><a href="http://{{ ip }}:8000/phc/final_sign_index/">尾包签名</a></li>
                        <li><a href="http://{{ ip }}:8000/phc/interval_sign_index/">固定间隔签名</a></li>
                    </ul>
                </li>
                <li> <a href="http://{{ ip }}:8000/phc/message_trace/"><i class="fa fa-map"></i>链式追溯</a></li>
                <li> <a href="http://{{ ip }}:8000/phc/datashow_page/"><i class="fa fa-bar-chart"></i>指标展示</a></li>
                <li><i class=""></i> </li>
                <li><i class=""></i> </li>
                <li><i class=""></i> </li>
                <li><i class=""></i> </li>
                <li><i class=""></i> </li>
                <li><i class=""></i> </li>
                <li><i class=""></i> </li>
                <li><i class=""></i> </li>
                <li><i class=""></i> </li>
                <li><i class=""></i> </li>
                <li><i class=""></i> </li>
                 <li><i class=""></i> </li>
                <li><i class=""></i> </li>
                <li><i class=""></i> </li>
                <li><i class=""></i> </li>
            </ul>
        </nav>

        <div class="content-inner form-cont">
            <div class="row">
                <div class="col-md-12">

                    <!--***** BASIC FORM *****-->
                    <div class="card form" id="form1">
                        <div class="card-header">
                            <h3>通信数据传输</h3>
                        </div>
                        <br>
                        <form>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="dip">报文哈希链两端ip</label>
                                        <input type="text" class="form-control" id="sip" disabled="disabled" aria-describedby="emailHelp" placeholder="{{ username_ip }}">
                                        <input type="text" class="form-control" id="dip" aria-describedby="emailHelp" placeholder="目的ip">

                                        <small id="emailHelp" class="form-text text-muted">两端ip地址构成哈希链</small>
                                        <button type="button" class="btn btn-general btn-outline-success mr-2" onclick="recv_msg_page()">验证详情页</button>
                                    </div>
                                    <div class="form-group">
                                        <label for="construction_method_select">哈希链构建方式</label>
                                        <select class="form-control" id="construction_method_select">
                                            <option value="1">基本构建方式</option>
                                            <option value="2">共享密钥构建方式</option>
                                            <option value="3">哈希加盐构建方式</option>
                                            <option value="4">双向哈希构建方式</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="signature_method_select">签名方式</label>
                                        <select class="form-control" id="signature_method_select">
                                            <option value="1">首包签名</option>
                                            <option value="2">尾包签名</option>
                                            <option value="3">间隔签名</option>
                                            <option value="4">即时签名</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="message_content">传输数据</label>
                                        <textarea class="form-control" id="message_content" rows="3"></textarea>
                                    </div>
{#                                    <div class="form-group">#}
{#                                        <label for="inputfile">上传文件</label>#}
{#                                        <input type="file" class="form-control-file" id="inputfile" aria-describedby="fileHelp">#}
{#                                    </div>#}
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="trans_message">交互数据</label>
                                        <div class="form-control" id="trans_message" rows="25" style="width:565px;height:360px;overflow-x:auto;overflow-y:auto"></div>
                                    </div>
                                </div>
                            </div> 
                            <button type="button" class="btn btn-general btn-blue mr-2" onclick="sendMessage()">发送</button>
                            <button type="button" class="btn btn-general btn-outline-danger mr-2" onclick="sendMessage_lot()">随机发送多条</button>
                        </form>
                    </div>


                </div>
            </div>
        </div>
    </div>

    <!--Global Javascript -->
    <script src="/static/index/js/jquery.min.js"></script>
    <script src="/static/index/js/jquery.cookie.js"></script>
    <script src="/static/index/js/popper/popper.min.js"></script>
    <script src="/static/index/js/tether.min.js"></script>
    <script src="/static/index/js/bootstrap.min.js"></script>
    <script src="/static/index/js/jquery.validate.min.js"></script>
    <script src="/static/index/js/chart.min.js"></script>
    <script src="/static/index/js/front.js"></script>
    
    <!--Core Javascript -->
    <script>
        new Chart(document.getElementById("myChart-nav").getContext('2d'), {
          type: 'doughnut',
          data: {
            labels: ["M", "T", "W", "T", "F", "S", "S"],
            datasets: [{
              backgroundColor: [
                "#2ecc71",
                "#3498db",
                "#95a5a6",
                "#9b59b6",
                "#f1c40f",
                "#e74c3c",
                "#34495e"
              ],
              data: [12, 19, 3, 17, 28, 24, 7]
            }]
          },
          options: {
              legend: { display: false },
              title: {
                display: true,
                text: ''
               } 
            }
        });
    </script>

</body>

</html>